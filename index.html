<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>景沛ESG 碳排放計算器</title>
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
    ...
</head>
<body>
    ...
    <script>
        function calculateCarbon() {
            const labels = ["電力", "水", "交通", "車用汽油", "柴油", "天然氣", "團體膳食", "洗潔精", "衛生紙", "廢(污)水處理"];
            const factors = [0.495, 0.156, 0.251, 2.92, 3.32, 2.63, 1.29, 1.32, 0.402, 0.533];
            const ids = ["electricity", "water", "transport", "gasoline", "diesel", "naturalGas", "meal", "detergent", "tissue", "wastewater"];
            let totalCarbon = 0;
            let details = "";
            ids.forEach((id, index) => {
                const value = parseFloat(document.getElementById(id).value) || 0;
                const carbon = value * factors[index];
                totalCarbon += carbon;
                details += `<div class='output-group'><label>${labels[index]}：</label><p>${carbon.toFixed(2)} kg CO₂</p></div>`;
            });
            document.getElementById('result').innerHTML = details;
            document.getElementById('totalEmission').innerHTML = `<h3>🌍 總碳排放量：${totalCarbon.toFixed(2)} kg CO₂</h3>`;
        }

        // PWA Installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.querySelector('.download-btn').style.display = 'block'; // Show the install button
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the A2HS prompt');
                    } else {
                        console.log('User dismissed the A2HS prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Copy URL to clipboard
        document.getElementById('copyUrlBtn').addEventListener('click', () => {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('URL 已複製到剪貼簿');
            }).catch((error) => {
                console.error('Failed to copy URL:', error);
            });
        });

        // Clear Cache
        function clearCache() {
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ action: 'clearCache' });
            }
        }

        // Service Worker registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
                .then((registration) => {
                    console.log('Service Worker 註冊成功', registration);
                    // Listen for messages from the service worker
                    navigator.serviceWorker.addEventListener('message', (event) => {
                        if (event.data.action === 'cacheCleared') {
                            alert('緩存已清除');
                        }
                    });
                })
                .catch((error) => console.log('Service Worker 註冊失敗:', error));
        }
    </script>
</body>
</html>
