<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ™¯æ²›ESG ç¢³æ’æ”¾è¨ˆç®—å™¨</title>
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
    ...
</head>
<body>
    ...
    <script>
        function calculateCarbon() {
            const labels = ["é›»åŠ›", "æ°´", "äº¤é€š", "è»Šç”¨æ±½æ²¹", "æŸ´æ²¹", "å¤©ç„¶æ°£", "åœ˜é«”è†³é£Ÿ", "æ´—æ½”ç²¾", "è¡›ç”Ÿç´™", "å»¢(æ±¡)æ°´è™•ç†"];
            const factors = [0.495, 0.156, 0.251, 2.92, 3.32, 2.63, 1.29, 1.32, 0.402, 0.533];
            const ids = ["electricity", "water", "transport", "gasoline", "diesel", "naturalGas", "meal", "detergent", "tissue", "wastewater"];
            let totalCarbon = 0;
            let details = "";
            ids.forEach((id, index) => {
                const value = parseFloat(document.getElementById(id).value) || 0;
                const carbon = value * factors[index];
                totalCarbon += carbon;
                details += `<div class='output-group'><label>${labels[index]}ï¼š</label><p>${carbon.toFixed(2)} kg COâ‚‚</p></div>`;
            });
            document.getElementById('result').innerHTML = details;
            document.getElementById('totalEmission').innerHTML = `<h3>ğŸŒ ç¸½ç¢³æ’æ”¾é‡ï¼š${totalCarbon.toFixed(2)} kg COâ‚‚</h3>`;
        }

        // PWA Installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.querySelector('.download-btn').style.display = 'block'; // Show the install button
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the A2HS prompt');
                    } else {
                        console.log('User dismissed the A2HS prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Copy URL to clipboard
        document.getElementById('copyUrlBtn').addEventListener('click', () => {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('URL å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
            }).catch((error) => {
                console.error('Failed to copy URL:', error);
            });
        });

        // Clear Cache
        function clearCache() {
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ action: 'clearCache' });
            }
        }

        // Service Worker registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
                .then((registration) => {
                    console.log('Service Worker è¨»å†ŠæˆåŠŸ', registration);
                    // Listen for messages from the service worker
                    navigator.serviceWorker.addEventListener('message', (event) => {
                        if (event.data.action === 'cacheCleared') {
                            alert('ç·©å­˜å·²æ¸…é™¤');
                        }
                    });
                })
                .catch((error) => console.log('Service Worker è¨»å†Šå¤±æ•—:', error));
        }
    </script>
</body>
</html>
